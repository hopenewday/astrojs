---
/**
 * AMP version of the Flash feed page
 * 
 * This page provides an AMP-compatible version of the Flash feed
 * for faster mobile loading and better user experience.
 */
import AmpBaseLayout from "../../layouts/AmpBaseLayout.astro";
import { transformToAmpHtml } from '../../utils/ampUtils';

// Sample data for demonstration (same as in regular flash.astro)
const articles = [
  {
    id: "1",
    title: "The Future of Artificial Intelligence in 2023",
    slug: "future-of-ai-2023",
    excerpt: "Exploring the latest advancements in AI and what they mean for society, business, and everyday life.",
    image: "/images/tech/ai-future.jpg",
    category: {
      name: "Tech",
      slug: "tech"
    },
    author: {
      name: "Alex Johnson",
      slug: "alex-johnson",
      avatar: "/images/authors/alex-johnson.jpg"
    },
    publishDate: new Date("2023-06-15"),
    trending: true,
    featured: true
  },
  {
    id: "2",
    title: "Modern Web Development Frameworks Compared",
    slug: "web-frameworks-compared",
    excerpt: "An in-depth analysis of the most popular web development frameworks in 2023, including React, Vue, and Svelte.",
    image: "/images/tech/web-dev.jpg",
    category: {
      name: "Tech",
      slug: "tech"
    },
    author: {
      name: "Sarah Chen",
      slug: "sarah-chen",
      avatar: "/images/authors/sarah-chen.jpg"
    },
    publishDate: new Date("2023-06-10")
  },
  {
    id: "3",
    title: "The Renaissance of Indie Filmmaking",
    slug: "indie-film-renaissance",
    excerpt: "How digital technology and streaming platforms are giving independent filmmakers unprecedented opportunities.",
    image: "/images/culture/indie-film.jpg",
    category: {
      name: "Culture",
      slug: "culture"
    },
    author: {
      name: "Michael Rivera",
      slug: "michael-rivera",
      avatar: "/images/authors/michael-rivera.jpg"
    },
    publishDate: new Date("2023-06-05")
  },
  {
    id: "4",
    title: "Climate Change: The Latest Research",
    slug: "climate-change-research",
    excerpt: "A summary of the most recent scientific findings on climate change and their implications for global policy.",
    image: "/images/science/climate.jpg",
    category: {
      name: "Science",
      slug: "science"
    },
    author: {
      name: "Dr. Emily Wong",
      slug: "emily-wong",
      avatar: "/images/authors/emily-wong.jpg"
    },
    publishDate: new Date("2023-06-01"),
    trending: true
  },
  {
    id: "5",
    title: "The Global Economy in a Post-Pandemic World",
    slug: "post-pandemic-economy",
    excerpt: "Analyzing the long-term economic impacts of the pandemic and strategies for sustainable recovery.",
    image: "/images/business/economy.jpg",
    category: {
      name: "Business",
      slug: "business"
    },
    author: {
      name: "Robert Kiyosaki",
      slug: "robert-kiyosaki",
      avatar: "/images/authors/robert-kiyosaki.jpg"
    },
    publishDate: new Date("2023-05-28")
  }
];

// Sort articles by publish date (newest first)
const sortedArticles = [...articles].sort((a, b) => 
  b.publishDate.getTime() - a.publishDate.getTime()
);

// Take the 10 latest articles
const latestArticles = sortedArticles.slice(0, 10);

// Format date for display
const formatDate = (date) => {
  return new Date(date).toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'short',
    day: 'numeric'
  });
};

// Generate canonical URL (non-AMP version)
const canonicalUrl = new URL('/flash', Astro.site).toString();
---

<AmpBaseLayout 
  title="Flash Feed - ChakrirChain" 
  description="Explore the latest articles in our Flash feed"
  canonicalURL={canonicalUrl}
  ampContent={`
    <amp-img></amp-img>
    <amp-sidebar></amp-sidebar>
    <amp-carousel></amp-carousel>
  `}
>
  <!-- Header -->
  <header class="flash-header">
    <div class="header-container">
      <a href="/amp/" class="site-logo">chakrirchain</a>
      <h1 class="flash-title">Flash</h1>
    </div>
  </header>
  
  <!-- Flash Feed -->
  <div class="flash-feed">
    <amp-carousel 
      height="100vh" 
      layout="fixed-height" 
      type="slides" 
      loop="true"
    >
      {latestArticles.map(article => (
        <div class="flash-card">
          <div class="flash-card-media">
            <amp-img 
              src={article.image} 
              width="720" 
              height="1280" 
              layout="responsive" 
              alt={article.title}
            ></amp-img>
            <div class="gradient-overlay"></div>
          </div>
          
          <div class="flash-card-content">
            <a href={`/amp/category/${article.category.slug}`} class="category-tag">
              {article.category.name}
            </a>
            
            <h2 class="article-title">
              <a href={`/article/amp/${article.slug}`}>{article.title}</a>
            </h2>
            
            <p class="article-excerpt">{article.excerpt}</p>
            
            <div class="article-meta">
              <span class="author-name">{article.author.name}</span>
              <span class="publish-date">{formatDate(article.publishDate)}</span>
            </div>
            
            <a href={`/article/amp/${article.slug}`} class="read-more-link">
              Read Full Article
            </a>
          </div>
        </div>
      ))}
    </amp-carousel>
  </div>
  
  <div class="flash-nav">
    <a href="/amp/" class="home-link">Back to Home</a>
  </div>
</AmpBaseLayout>

<style amp-custom>
  /* Flash Header */
  .flash-header {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    z-index: 10;
    background: linear-gradient(to bottom, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0) 100%);
    padding: 1rem;
  }
  
  .header-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  
  .site-logo {
    font-weight: bold;
    font-size: 1.25rem;
    color: white;
    text-decoration: none;
  }
  
  .flash-title {
    font-size: 1.25rem;
    color: white;
    margin: 0;
  }
  
  /* Flash Feed */
  .flash-feed {
    height: 100vh;
    width: 100%;
  }
  
  /* Flash Card */
  .flash-card {
    position: relative;
    height: 100vh;
    width: 100%;
    overflow: hidden;
  }
  
  .flash-card-media {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }
  
  .gradient-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(to bottom, rgba(0,0,0,0.2) 0%, rgba(0,0,0,0.8) 100%);
  }
  
  .flash-card-content {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    padding: 2rem 1.5rem;
    color: white;
  }
  
  /* Article Styles */
  .category-tag {
    display: inline-block;
    font-size: 0.875rem;
    font-weight: 600;
    color: #3b82f6;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 0.75rem;
    text-decoration: none;
  }
  
  .article-title {
    font-size: 1.75rem;
    line-height: 1.3;
    margin: 0 0 1rem 0;
  }
  
  .article-title a {
    color: white;
    text-decoration: none;
  }
  
  .article-excerpt {
    font-size: 1rem;
    line-height: 1.5;
    margin: 0 0 1.5rem 0;
    opacity: 0.9;
  }
  
  .article-meta {
    display: flex;
    font-size: 0.875rem;
    margin-bottom: 1.5rem;
    opacity: 0.8;
  }
  
  .author-name {
    font-weight: 500;
    margin-right: 0.5rem;
  }
  
  .author-name:after {
    content: "â€¢";
    margin-left: 0.5rem;
  }
  
  .read-more-link {
    display: inline-block;
    background-color: #3b82f6;
    color: white;
    font-size: 0.875rem;
    font-weight: 500;
    padding: 0.5rem 1rem;
    border-radius: 0.25rem;
    text-decoration: none;
  }
  
  /* Flash Nav */
  .flash-nav {
    position: fixed;
    bottom: 1.5rem;
    left: 0;
    width: 100%;
    display: flex;
    justify-content: center;
    z-index: 10;
  }
  
  .home-link {
    background-color: rgba(0, 0, 0, 0.7);
    color: white;
    font-size: 0.875rem;
    font-weight: 500;
    padding: 0.5rem 1rem;
    border-radius: 2rem;
    text-decoration: none;
  }
</style>